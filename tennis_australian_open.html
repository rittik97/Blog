<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Using a Neural Network to predict the Australian Open | dark_coffee
</title>
  <link rel="canonical" href="./tennis_australian_open.html">


  <link rel="stylesheet" href="./theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="./theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="./theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="./theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://rittik97.github.io/Blog/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://rittik97.github.io/Blog/feeds/sports.atom.xml">  
  <meta name="description" content="I was introduced to tennis when I was very young by my grandfather and have distinct memories of watching Sampras, Agassi, and Hingis. While I no longer avidly follow the sport, I wanted to use a neural network to predict tennis matches and see how it performs when compared with â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title"><a href="./">dark_coffee</a></h1>
  </div>
</div>    </div>
  </header>
  <div class="main">
    <div class="container">
    <div class="row">
      <ul class="col-sm-6 list-inline">
        <li class="list-inline-item"><a href="https://github.com/rittik97">Github</a></li>
        <li class="list-inline-item"><a href="https://www.linkedin.com/in/rittikghosh/">LinkedIn</a></li>
        <li class="list-inline-item"><a href="./categories.html">Categories</a></li>
      </ul>
      <hr />
    </div>
  </div>
  </div>
  <div class="main">

    <div class="container">
      <h1>  Using a Neural Network to predict the Australian Open
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2020-02-08T18:44:00-05:00">
          <i class="fas fa-clock"></i>
          Sat 08 February 2020
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="./category/sports.html">Sports</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-user"></i>
              <a href="./author/rittik-ghosh.html">Rittik Ghosh</a>          </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="./tag/neural-network.html">#Neural Network</a>,               <a href="./tag/classification.html">#Classification</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>I was introduced to tennis when I was very young by my grandfather and have distinct memories of watching Sampras, Agassi, and Hingis. While I no longer avidly follow the sport, I wanted to use a neural network to predict tennis matches and see how it performs when compared with the results of the recently concluded Australian Open. Data was gathered from <a href="http://www.tennis-data.co.uk/alldata.php">here.</a> I decided to use data from 2015 onwards. At the time of writing, data for the Australian Open itself had not been uploaded to the site, so these matches would be unseen for our model. Comparative results on the last few rounds can be found at the bottom of this post.</p>
<p>The dataset marks out the winner and loser, we reset the winner and all his associated metrics such as rank to be player one. Similarly, all metrics associated with the loser are set to player two.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">player_one</span><span class="p">(</span><span class="n">Winner</span><span class="p">,</span><span class="n">WRank</span><span class="p">,</span><span class="n">Loser</span><span class="p">,</span><span class="n">LRank</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">WRank</span><span class="o">&lt;</span><span class="n">LRank</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Winner</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Loser</span>

<span class="k">def</span> <span class="nf">player_two</span><span class="p">(</span><span class="n">Winner</span><span class="p">,</span><span class="n">WRank</span><span class="p">,</span><span class="n">Loser</span><span class="p">,</span><span class="n">LRank</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">WRank</span><span class="o">&lt;</span><span class="n">LRank</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Loser</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Winner</span>

<span class="k">def</span> <span class="nf">player_one_rank</span><span class="p">(</span><span class="n">Winner</span><span class="p">,</span><span class="n">WRank</span><span class="p">,</span><span class="n">Loser</span><span class="p">,</span><span class="n">LRank</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">WRank</span><span class="o">&lt;</span><span class="n">LRank</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WRank</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LRank</span>

<span class="k">def</span> <span class="nf">player_two_rank</span><span class="p">(</span><span class="n">Winner</span><span class="p">,</span><span class="n">WRank</span><span class="p">,</span><span class="n">Loser</span><span class="p">,</span><span class="n">LRank</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">WRank</span><span class="o">&lt;</span><span class="n">LRank</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LRank</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WRank</span>        


<span class="n">data</span><span class="p">[</span><span class="s1">&#39;player_one&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">player_one</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Winner&#39;</span><span class="p">]</span>
                                                     <span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;WRank&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Loser&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LRank&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;player_two&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">player_two</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Winner&#39;</span><span class="p">]</span>
                                                     <span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;WRank&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Loser&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LRank&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">data</span><span class="p">[</span><span class="s1">&#39;player_one_rank&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">player_one_rank</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Winner&#39;</span><span class="p">]</span>
                                                               <span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;WRank&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Loser&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LRank&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;player_two_rank&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">player_two_rank</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Winner&#39;</span><span class="p">]</span>
                                                               <span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;WRank&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Loser&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LRank&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>The question we are essentially asking is "Will the higher-ranked player win?"
Based on our data it turns out that the higher-ranked player wins 63.7% of the time.</p>
<p>To capture the player's form, we create features that represent his performance over the last year. 
We look at the overall win rate as well as win rates by surface and length of the match (3 or 5 sets). I introduced UUIDs into the dataset to have a "primary key" that can be used to join different data frames that represent computations and slices of the original data.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cal_player_stats</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">uuid</span><span class="p">):</span>
    <span class="n">three</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">five</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">clay</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">hard</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">grass</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">temp</span><span class="o">=</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">player_one</span><span class="o">==</span><span class="n">name</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">player_two</span><span class="o">==</span><span class="n">name</span><span class="p">)]</span>
        <span class="n">cutoff_date</span><span class="o">=</span><span class="n">date</span><span class="o">-</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
        <span class="n">temp</span><span class="o">=</span><span class="n">temp</span><span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">Date</span><span class="o">&gt;</span><span class="n">cutoff_date</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> 
        <span class="k">else</span><span class="p">:</span>

            <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;Best of&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">[(</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;Best of&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">outcome</span><span class="o">==</span><span class="mi">1</span><span class="p">)]))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">temp</span><span class="p">[</span><span class="s1">&#39;Best of&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="o">.</span><span class="n">Surface</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">[(</span><span class="n">temp</span><span class="o">.</span><span class="n">Surface</span><span class="o">==</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">outcome</span><span class="o">==</span><span class="mi">1</span><span class="p">)]))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">temp</span><span class="o">.</span><span class="n">Surface</span><span class="o">==</span><span class="n">i</span><span class="p">]))</span>    
            <span class="k">if</span> <span class="s1">&#39;3&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">three</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;5&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">five</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;Grass&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">grass</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Grass&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;Hard&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">hard</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Hard&#39;</span><span class="p">])</span>       
            <span class="k">if</span> <span class="s1">&#39;Clay&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">clay</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Clay&#39;</span><span class="p">])</span>        
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">uuid</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">cutoff_date</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">outcome</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span> <span class="n">clay</span><span class="p">,</span> <span class="n">grass</span><span class="p">,</span> <span class="n">hard</span><span class="p">,</span> <span class="n">three</span><span class="p">,</span> <span class="n">five</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_obj</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">exc_tb</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>


<span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span><span class="o">&gt;=</span><span class="s1">&#39;2016-01-01&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">cal_player_stats</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;player_one&#39;</span><span class="p">]</span>
                                                                   <span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;uuid&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>We also compute the same statistics on player vs player basis to evaluate past matches between the two players.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_rate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.0</span>  

<span class="k">def</span> <span class="nf">onevtwo</span><span class="p">(</span><span class="n">player_one_name</span><span class="p">,</span><span class="n">player_two_name</span><span class="p">,</span><span class="n">cut_off_date</span><span class="p">,</span><span class="n">uuid</span><span class="p">):</span>
    <span class="n">three</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">five</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">clay</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">hard</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">grass</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">win_rate</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">total</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">temp</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">Date</span><span class="o">&gt;</span><span class="n">cut_off_date</span><span class="p">]</span>
        <span class="n">wins</span><span class="o">=</span><span class="n">temp</span><span class="p">[(</span><span class="n">temp</span><span class="o">.</span><span class="n">Winner</span><span class="o">==</span><span class="n">player_one_name</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">Loser</span><span class="o">==</span><span class="n">player_two_name</span><span class="p">)]</span>
        <span class="n">losses</span><span class="o">=</span><span class="n">temp</span><span class="p">[(</span><span class="n">temp</span><span class="o">.</span><span class="n">Loser</span><span class="o">==</span><span class="n">player_one_name</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">Winner</span><span class="o">==</span><span class="n">player_two_name</span><span class="p">)]</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">win_rate</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">)</span><span class="o">/</span><span class="n">total</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;Best of&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="n">calc_rate</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">[</span><span class="n">wins</span><span class="p">[</span><span class="s1">&#39;Best of&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">losses</span><span class="p">[</span><span class="n">losses</span><span class="p">[</span><span class="s1">&#39;Best of&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">temp</span><span class="o">.</span><span class="n">Surface</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">calc_rate</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wins</span><span class="p">[</span><span class="n">wins</span><span class="o">.</span><span class="n">Surface</span><span class="o">==</span><span class="n">i</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">losses</span><span class="p">[</span><span class="n">losses</span><span class="o">.</span><span class="n">Surface</span><span class="o">==</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">if</span> <span class="s1">&#39;3&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">three</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;5&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">five</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;Grass&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">grass</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Grass&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;Hard&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">hard</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Hard&#39;</span><span class="p">])</span>       
        <span class="k">if</span> <span class="s1">&#39;Clay&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">clay</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;Clay&#39;</span><span class="p">])</span>        
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">uuid</span><span class="p">,</span><span class="n">player_one_name</span><span class="p">,</span><span class="n">cut_off_date</span><span class="p">,</span><span class="n">win_rate</span><span class="p">,</span><span class="n">total</span><span class="p">,</span> <span class="n">clay</span><span class="p">,</span> <span class="n">grass</span><span class="p">,</span> <span class="n">hard</span><span class="p">,</span> <span class="n">three</span><span class="p">,</span> <span class="n">five</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_obj</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">exc_tb</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span> <span class="n">player_one_name</span><span class="p">,</span> <span class="n">cut_off_date</span><span class="p">)</span>
</pre></div>


<p>Since we are looking at the Australian Open, we are going to use only data on matches played on hard surfaces. 
The DataFrameMapper below gives an overview of the input features and the transformations applied to each of them.</p>
<div class="highlight"><pre><span></span><span class="n">mapper</span> <span class="o">=</span> <span class="n">DataFrameMapper</span><span class="p">([</span>
    <span class="p">([</span><span class="s1">&#39;player_one_rank&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">StandardScaler</span><span class="p">(),</span><span class="n">SimpleImputer</span><span class="p">()]),</span>
    <span class="p">([</span><span class="s1">&#39;player_two_rank&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">StandardScaler</span><span class="p">(),</span><span class="n">SimpleImputer</span><span class="p">()]),</span>
    <span class="p">(</span><span class="s1">&#39;Best of&#39;</span><span class="p">,</span> <span class="n">LabelEncoder</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;one_win_rate_year&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;one_games_played_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;one_hard_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;one_three_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;one_five_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;two_win_rate_year&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;two_games_played_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;two_hard_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;two_three_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;two_five_year&#39;</span><span class="p">],</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">LabelEncoder</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;one_win_rate_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span> 
    <span class="p">([</span><span class="s1">&#39;one_games_played_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">([</span><span class="s1">&#39;one_hard_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">([</span><span class="s1">&#39;one_three_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">([</span><span class="s1">&#39;one_five_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">([</span><span class="s1">&#39;two_win_rate_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span> 
    <span class="p">([</span><span class="s1">&#39;two_games_played_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">([</span><span class="s1">&#39;two_hard_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">([</span><span class="s1">&#39;two_three_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">([</span><span class="s1">&#39;two_five_vv&#39;</span><span class="p">],</span><span class="n">StandardScaler</span><span class="p">()),</span>    

<span class="p">],</span> <span class="n">df_out</span><span class="o">=</span>
    <span class="kc">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#topology</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Z_train</span><span class="o">.</span><span class="n">columns</span><span class="p">),)))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">))</span>

<span class="n">m</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span> 
<span class="n">model_checkpoint</span><span class="o">=</span><span class="n">ModelCheckpoint</span><span class="p">(</span><span class="s1">&#39;data/best_model.h5&#39;</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">early_stop</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">,</span> <span class="n">min_delta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">hist</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">Z_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span> 
                    <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
                    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">Z_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                    <span class="n">epochs</span><span class="o">=</span><span class="mi">175</span><span class="p">,</span>
                    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stop</span><span class="p">,</span><span class="n">mc</span><span class="p">],</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p><img src="images/tennis_acc.png"></p>
<p>We do beat our naive estimate of 63.7%,  the best model scores an accuracy of 69.3% on our test set. I was hoping for better results but in my opinion, given the unpredictable world of sports this result should be construed as not bad.</p>
<h1>Results:</h1>
<p><img src='images/australian_open.png'></p>
<p>The nodes colored green represent correct predictions while those colored red represent incorrect ones. Each vertice has a probability associated with it. This is the probability predicted by our model for the true outcome to occur. As expected, for red nodes, the model predicts a probability of less than 50%.</p>
<p>There are opportunities to better engineer our features and bring in new data points and I look to forward to improving this score in the next iteration. </p>
    </div>
  </article>



    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="./authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="./archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="./categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="./tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>